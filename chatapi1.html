<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="description" content="CHAT API by WebXOS is a lightweight, browser-based, offline-capable chat system for private networks. Generate API keys client-side for secure, peer-to-peer messaging with a minimalist, terminal-style UI.">
    <meta name="keywords" content="private chat, secure messaging, WebRTC chat, offline chat, browser-based chat, lightweight chat app, API key chat, peer-to-peer chat, minimalist chat, terminal-style chat, WebXOS, private network chat, decentralized chat, client-side chat">
    <meta name="author" content="WebXOS">
    <meta name="robots" content="index, follow">
    <!-- Twitter Meta Tags -->
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="CHAT API by WebXOS">
    <meta name="twitter:description" content="A lightweight, browser-based chat system for private networks with client-side API keys and a minimalist terminal UI.">
    <meta name="twitter:site" content="@webxos">
    <meta name="twitter:creator" content="@webxos">
    <!-- Open Graph Meta Tags -->
    <meta property="og:title" content="CHAT API by WebXOS">
    <meta property="og:description" content="Secure, lightweight chat for private networks. Browser-based, offline-capable, with client-side API keys and a retro terminal interface.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://chatapi.webxos.com"> <!-- Replace with your actual URL -->
    <meta property="og:site_name" content="CHAT API by WebXOS">
    <!-- JSON-LD Structured Data -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "SoftwareApplication",
        "name": "CHAT API by WebXOS",
        "applicationCategory": "Communication",
        "operatingSystem": "Web",
        "description": "A lightweight, browser-based chat system for private networks with client-side API key generation, WebRTC for peer-to-peer messaging, and a minimalist terminal-style UI.",
        "author": {
            "@type": "Organization",
            "name": "WebXOS",
            "sameAs": [
                "https://twitter.com/webxos",
                "https://twitter.com/webxos_ai",
                "https://twitter.com/webxos_games"
            ]
        },
        "featureList": [
            "Private chat rooms",
            "Secure messaging",
            "Offline capability",
            "WebRTC peer-to-peer",
            "Client-side API keys",
            "Minimalist UI"
        ]
    }
    </script>
    <title>CHAT API by WebXOS</title>
    <style>
        body {
            background-color: #000;
            color: #0f0;
            font-family: 'Courier New', monospace;
            margin: 0;
            padding: 10px;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            font-size: 16px;
        }
        h1 {
            text-align: center;
            font-size: 5vw;
            text-shadow: 0 0 5px #0f0;
            margin: 10px 0;
        }
        #start-menu, #container {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 15px;
            max-width: 800px;
            margin: 0 auto;
        }
        #container { display: none; }
        #start-menu button, #modal-content button, #chat button {
            background: #111;
            color: #0f0;
            border: 1px solid #0f0;
            padding: 12px;
            font-size: 4vw;
            cursor: pointer;
            border-radius: 5px;
            width: 80%;
            max-width: 300px;
            transition: background 0.3s, color 0.3s;
        }
        #start-menu button:hover, #modal-content button:hover, #chat button:hover {
            background: #0f0;
            color: #000;
        }
        #modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        #modal-content {
            background: #111;
            padding: 20px;
            border: 1px solid #0f0;
            border-radius: 5px;
            width: 90%;
            max-width: 400px;
            text-align: center;
        }
        #modal-content input, #modal-content textarea {
            background: #222;
            color: #0f0;
            border: 1px solid #0f0;
            padding: 10px;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
            width: 100%;
            box-sizing: border-box;
            font-size: 4vw;
            border-radius: 3px;
        }
        #chat, #profile, #room {
            width: 100%;
            border: 1px solid #0f0;
            padding: 10px;
            border-radius: 5px;
            box-shadow: 0 0 5px #0f0;
        }
        #chat-messages {
            height: 50vh;
            overflow-y: auto;
            border: 1px solid #0f0;
            padding: 10px;
            margin-bottom: 10px;
            background: #111;
        }
        .message {
            margin: 8px 0;
            word-wrap: break-word;
        }
        .message img {
            max-width: 70%;
            border-radius: 5px;
            margin: 5px 0;
        }
        .message a {
            color: #0f0;
            text-decoration: underline;
        }
        #chat input, #room textarea {
            background: #222;
            color: #0f0;
            border: 1px solid #0f0;
            padding: 10px;
            margin: 5px 0;
            font-family: 'Courier New', monospace;
            width: 100%;
            box-sizing: border-box;
            font-size: 4vw;
            border-radius: 3px;
        }
        #file-input {
            padding: 5px;
        }
        #footer {
            text-align: center;
            font-size: 3vw;
            margin: 10px 0;
            text-shadow: 0 0 3px #0f0;
        }
        @media (min-width: 768px) {
            body { font-size: 18px; }
            h1 { font-size: 2.5em; }
            #start-menu button, #modal-content button, #chat button { font-size: 1.2em; max-width: 400px; }
            #modal-content input, #modal-content textarea, #chat input, #room textarea { font-size: 1.1em; }
            #container { max-width: 1200px; }
            #chat-messages { height: 60vh; }
        }
        @media (max-width: 600px) {
            body { font-size: 14px; }
            h1 { font-size: 6vw; }
            #start-menu button, #modal-content button, #chat button { font-size: 5vw; }
            #modal-content input, #modal-content textarea, #chat input, #room textarea { font-size: 5vw; }
        }
    </style>
</head>
<body>
    <div id="start-menu">
        <h1>CHAT API by WebXOS</h1>
        <button onclick="showCreateRoomModal()">Create Room</button>
        <button onclick="showJoinRoomModal()">Join Room</button>
    </div>
    <div id="modal">
        <div id="modal-content">
            <h2 id="modal-title">Create Room</h2>
            <input type="text" id="username-input" placeholder="Enter Username">
            <input type="text" id="api-key-input" placeholder="API Key (Room ID)" readonly>
            <textarea id="signaling-data" placeholder="Paste peer's signaling data"></textarea>
            <button id="modal-action" onclick="handleModalAction()">Create Room</button>
        </div>
    </div>
    <div id="container">
        <h1>CHAT API by WebXOS</h1>
        <div id="profile">
            <h2>Profile</h2>
            <div>Username: <span id="username"></span></div>
            <div>Room ID (API Key): <span id="api-key"></span></div>
        </div>
        <div id="room">
            <h2>Room</h2>
            <div>Share this Room ID: <span id="room-id"></span></div>
            <textarea id="signaling-data-main" placeholder="Paste peer's signaling data"></textarea>
            <button onclick="processSignalingData()">Process Signaling</button>
            <div>Offer: <span id="offer-data"></span></div>
        </div>
        <div id="chat">
            <h2>Messages</h2>
            <div id="chat-messages"></div>
            <input type="text" id="message-input" placeholder="Type a message...">
            <input type="file" id="file-input" accept="image/*,*">
            <button onclick="sendMessage()">Send</button>
        </div>
    </div>
    <div id="footer">Â© CHAT API by WebXOS 2025</div>

    <script>
        // Generate UUID for API Key (Room ID)
        function generateUUID() {
            return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, c => {
                const r = Math.random() * 16 | 0;
                return (c === 'x' ? r : (r & 0x3 | 0x8)).toString(16);
            });
        }

        // Initialize IndexedDB
        const dbRequest = indexedDB.open('ChatAPIDB', 1);
        let db;

        dbRequest.onupgradeneeded = event => {
            db = event.target.result;
            db.createObjectStore('agents', { keyPath: 'id' });
            db.createObjectStore('messages', { autoIncrement: true });
            db.createObjectStore('files', { keyPath: 'id' });
            db.createObjectStore('rooms', { keyPath: 'id' });
        };

        dbRequest.onsuccess = event => {
            db = event.target.result;
            checkLogin();
        };

        // WebRTC Setup
        const configuration = { iceServers: [{ urls: 'stun:stun.l.google.com:19302' }] };
        let peerConnection;
        let dataChannel;
        let apiKey = localStorage.getItem('apiKey');
        let username = localStorage.getItem('username');
        let currentRoom = '';

        function checkLogin() {
            document.getElementById('start-menu').style.display = 'flex';
        }

        function showCreateRoomModal() {
            document.getElementById('modal-title').textContent = 'Create Room';
            document.getElementById('modal-action').textContent = 'Create Room';
            document.getElementById('api-key-input').value = generateUUID();
            document.getElementById('api-key-input').readOnly = true;
            document.getElementById('username-input').value = '';
            document.getElementById('signaling-data').value = '';
            document.getElementById('modal').style.display = 'flex';
            document.getElementById('modal-action').onclick = handleCreateRoom;
        }

        function showJoinRoomModal() {
            document.getElementById('modal-title').textContent = 'Join Room';
            document.getElementById('modal-action').textContent = 'Join Room';
            document.getElementById('api-key-input').value = '';
            document.getElementById('api-key-input').readOnly = false;
            document.getElementById('username-input').value = '';
            document.getElementById('signaling-data').value = '';
            document.getElementById('modal').style.display = 'flex';
            document.getElementById('modal-action').onclick = handleJoinRoom;
        }

        function handleCreateRoom() {
            username = document.getElementById('username-input').value.trim() || `Agent_${Math.random().toString(36).substr(2, 5)}`;
            apiKey = document.getElementById('api-key-input').value.trim();
            const signalingData = document.getElementById('signaling-data').value.trim();
            if (username && apiKey) {
                localStorage.setItem('apiKey', apiKey);
                localStorage.setItem('username', username);
                currentRoom = apiKey;
                initializeApp();
                if (signalingData) processSignalingData(signalingData);
            } else {
                alert('Please enter a username and API key.');
            }
        }

        function handleJoinRoom() {
            username = document.getElementById('username-input').value.trim() || `Agent_${Math.random().toString(36).substr(2, 5)}`;
            apiKey = document.getElementById('api-key-input').value.trim();
            const signalingData = document.getElementById('signaling-data').value.trim();
            if (username && apiKey) {
                localStorage.setItem('apiKey', apiKey);
                localStorage.setItem('username', username);
                currentRoom = apiKey;
                initializeApp();
                if (signalingData) processSignalingData(signalingData);
            } else {
                alert('Please enter a username and API key.');
            }
        }

        function initializeApp() {
            document.getElementById('start-menu').style.display = 'none';
            document.getElementById('modal').style.display = 'none';
            document.getElementById('container').style.display = 'flex';
            document.getElementById('username').textContent = username;
            document.getElementById('api-key').textContent = apiKey;
            document.getElementById('room-id').textContent = apiKey;

            // Save user profile and room
            const agent = { id: apiKey, username, status: 'online' };
            const room = { id: apiKey, creator: username };
            const tx = db.transaction(['agents', 'rooms'], 'readwrite');
            tx.objectStore('agents').put(agent);
            tx.objectStore('rooms').put(room);
            tx.oncomplete = () => {
                initWebRTC();
                loadMessages();
            };
        }

        // WebRTC Peer Connection
        function initWebRTC() {
            if (peerConnection) peerConnection.close();
            peerConnection = new RTCPeerConnection(configuration);
            dataChannel = peerConnection.createDataChannel(`chat-${currentRoom}`);

            dataChannel.onmessage = event => {
                const msg = JSON.parse(event.data);
                if (msg.type === 'file') {
                    saveFile(msg);
                    appendFileMessage(msg);
                } else {
                    saveMessage(msg);
                    appendMessage(`${msg.sender}: ${msg.content}`);
                }
            };

            dataChannel.onopen = () => console.log('Data channel open');
            dataChannel.onclose = () => console.log('Data channel closed');

            peerConnection.onicecandidate = event => {
                if (event.candidate) {
                    const offerData = JSON.stringify(peerConnection.localDescription);
                    document.getElementById('offer-data').textContent = offerData;
                    alert('Share this offer: ' + offerData);
                }
            };

            peerConnection.createOffer().then(offer => {
                peerConnection.setLocalDescription(offer);
            }).catch(error => console.error('Offer creation error:', error));
        }

        // Process Signaling Data
        function processSignalingData(data) {
            const signalingData = data || document.getElementById('signaling-data-main').value.trim();
            try {
                const parsedData = JSON.parse(signalingData);
                if (parsedData.type === 'offer') {
                    peerConnection.setRemoteDescription(new RTCSessionDescription(parsedData));
                    peerConnection.createAnswer().then(answer => {
                        peerConnection.setLocalDescription(answer);
                        document.getElementById('offer-data').textContent = JSON.stringify(answer);
                        alert('Share this answer: ' + JSON.stringify(answer));
                    });
                } else if (parsedData.type === 'answer') {
                    peerConnection.setRemoteDescription(new RTCSessionDescription(parsedData));
                }
            } catch (error) {
                console.error('Signaling error:', error);
                alert('Invalid signaling data.');
            }
        }

        // Chat Functionality
        function sendMessage() {
            const input = document.getElementById('message-input');
            const fileInput = document.getElementById('file-input');
            if (!currentRoom) {
                alert('Please join or create a room.');
                return;
            }
            if (fileInput.files.length > 0) {
                const file = fileInput.files[0];
                const reader = new FileReader();
                reader.onload = () => {
                    const msgData = {
                        type: 'file',
                        sender: username,
                        room: currentRoom,
                        fileName: file.name,
                        fileData: reader.result,
                        timestamp: Date.now()
                    };
                    if (dataChannel?.readyState === 'open') {
                        dataChannel.send(JSON.stringify(msgData));
                        saveFile(msgData);
                        appendFileMessage(msgData);
                    } else {
                        alert('No active peer connection.');
                    }
                };
                reader.readAsDataURL(file);
                fileInput.value = '';
            } else {
                const message = input.value.trim();
                if (message && dataChannel?.readyState === 'open') {
                    const msgData = { sender: username, content: message, room: currentRoom, timestamp: Date.now() };
                    dataChannel.send(JSON.stringify(msgData));
                    saveMessage(msgData);
                    appendMessage(`${username}: ${message}`);
                    input.value = '';
                } else {
                    alert('No active peer connection or empty message.');
                }
            }
        }

        // Save Message to IndexedDB
        function saveMessage(msg) {
            const tx = db.transaction(['messages'], 'readwrite');
            tx.objectStore('messages').add(msg);
        }

        // Save File to IndexedDB
        function saveFile(msg) {
            const tx = db.transaction(['files'], 'readwrite');
            tx.objectStore('files').add({ id: generateUUID(), ...msg });
        }

        // Display Messages
        function appendMessage(text) {
            const messages = document.getElementById('chat-messages');
            const msgDiv = document.createElement('div');
            msgDiv.className = 'message';
            msgDiv.textContent = text;
            messages.appendChild(msgDiv);
            messages.scrollTop = messages.scrollHeight;
        }

        // Display File Messages
        function appendFileMessage(msg) {
            const messages = document.getElementById('chat-messages');
            const msgDiv = document.createElement('div');
            msgDiv.className = 'message';
            if (msg.fileData.startsWith('data:image/')) {
                const img = document.createElement('img');
                img.src = msg.fileData;
                msgDiv.textContent = `${msg.sender} shared an image:`;
                msgDiv.appendChild(img);
            } else {
                const link = document.createElement('a');
                link.href = msg.fileData;
                link.download = msg.fileName;
                link.textContent = msg.fileName;
                msgDiv.textContent = `${msg.sender} shared a file: `;
                msgDiv.appendChild(link);
            }
            messages.appendChild(msgDiv);
            messages.scrollTop = messages.scrollHeight;
        }

        // Load Messages for Current Room
        function loadMessages() {
            const tx = db.transaction(['messages', 'files'], 'readonly');
            const msgStore = tx.objectStore('messages');
            const fileStore = tx.objectStore('files');
            const messages = document.getElementById('chat-messages');
            messages.innerHTML = '';

            msgStore.getAll().onsuccess = event => {
                event.target.result.forEach(msg => {
                    if (msg.room === currentRoom) {
                        appendMessage(`${msg.sender}: ${msg.content}`);
                    }
                });
            };

            fileStore.getAll().onsuccess = event => {
                event.target.result.forEach(file => {
                    if (file.room === currentRoom) {
                        appendFileMessage(file);
                    }
                });
            };
        }

        // Update Status on Disconnect
        window.onbeforeunload = () => {
            const tx = db.transaction(['agents'], 'readwrite');
            tx.objectStore('agents').put({ id: apiKey, username, status: 'offline' });
        };
    </script>
</body>
</html>
